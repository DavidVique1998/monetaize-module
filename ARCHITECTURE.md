# ๐๏ธ Arquitectura del Panel Retell AI

## ๐ Diagrama de Arquitectura

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    FRONTEND (Next.js 16)                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ        โ
โ  โ  Dashboard  โ  โ   Agents    โ  โ   Voices    โ        โ
โ  โ   Page      โ  โ Management  โ  โ  Config     โ        โ
โ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ        โ
โ                                                             โ
โ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ        โ
โ  โ   Prompts   โ  โ  Analytics  โ  โ  Settings   โ        โ
โ  โ   Editor    โ  โ   & Usage   โ  โ   Panel     โ        โ
โ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    API LAYER (Next.js)                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ        โ
โ  โ   Agents    โ  โ   Voices    โ  โ   Prompts   โ        โ
โ  โ   API       โ  โ    API      โ  โ    API      โ        โ
โ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ        โ
โ                                                             โ
โ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ        โ
โ  โ  Analytics  โ  โ  Webhooks   โ  โ    Auth     โ        โ
โ  โ    API      โ  โ    API      โ  โ    API      โ        โ
โ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  EXTERNAL SERVICES                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ        โ
โ  โ  Retell AI  โ  โ   11labs    โ  โ  Database   โ        โ
โ  โ     SDK     โ  โ     API     โ  โ PostgreSQL  โ        โ
โ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐๏ธ Estructura de Directorios

```
monetaize-module/
โโโ src/
โ   โโโ app/
โ   โ   โโโ (auth)/
โ   โ   โ   โโโ login/
โ   โ   โ   โโโ register/
โ   โ   โโโ dashboard/
โ   โ   โ   โโโ page.tsx
โ   โ   โ   โโโ layout.tsx
โ   โ   โโโ agents/
โ   โ   โ   โโโ page.tsx
โ   โ   โ   โโโ [id]/
โ   โ   โ   โ   โโโ page.tsx
โ   โ   โ   โ   โโโ edit/
โ   โ   โ   โโโ new/
โ   โ   โโโ voices/
โ   โ   โ   โโโ page.tsx
โ   โ   โ   โโโ [id]/
โ   โ   โโโ prompts/
โ   โ   โ   โโโ page.tsx
โ   โ   โ   โโโ [id]/
โ   โ   โ   โโโ editor/
โ   โ   โโโ analytics/
โ   โ   โ   โโโ page.tsx
โ   โ   โโโ settings/
โ   โ   โ   โโโ page.tsx
โ   โ   โโโ api/
โ   โ   โ   โโโ auth/
โ   โ   โ   โโโ agents/
โ   โ   โ   โโโ voices/
โ   โ   โ   โโโ prompts/
โ   โ   โ   โโโ analytics/
โ   โ   โ   โโโ webhooks/
โ   โ   โโโ globals.css
โ   โ   โโโ layout.tsx
โ   โ   โโโ page.tsx
โ   โโโ components/
โ   โ   โโโ ui/
โ   โ   โ   โโโ button.tsx
โ   โ   โ   โโโ input.tsx
โ   โ   โ   โโโ card.tsx
โ   โ   โ   โโโ modal.tsx
โ   โ   โ   โโโ ...
โ   โ   โโโ forms/
โ   โ   โ   โโโ agent-form.tsx
โ   โ   โ   โโโ voice-selector.tsx
โ   โ   โ   โโโ prompt-editor.tsx
โ   โ   โโโ charts/
โ   โ   โ   โโโ usage-chart.tsx
โ   โ   โ   โโโ cost-chart.tsx
โ   โ   โ   โโโ performance-chart.tsx
โ   โ   โโโ modals/
โ   โ   โ   โโโ confirm-modal.tsx
โ   โ   โ   โโโ settings-modal.tsx
โ   โ   โ   โโโ preview-modal.tsx
โ   โ   โโโ layout/
โ   โ       โโโ sidebar.tsx
โ   โ       โโโ header.tsx
โ   โ       โโโ navigation.tsx
โ   โโโ hooks/
โ   โ   โโโ use-agents.ts
โ   โ   โโโ use-voices.ts
โ   โ   โโโ use-analytics.ts
โ   โ   โโโ use-retell.ts
โ   โโโ lib/
โ   โ   โโโ retell.ts
โ   โ   โโโ db.ts
โ   โ   โโโ auth.ts
โ   โ   โโโ utils.ts
โ   โ   โโโ validations.ts
โ   โโโ types/
โ   โ   โโโ agent.ts
โ   โ   โโโ voice.ts
โ   โ   โโโ prompt.ts
โ   โ   โโโ analytics.ts
โ   โโโ store/
โ       โโโ agent-store.ts
โ       โโโ voice-store.ts
โ       โโโ analytics-store.ts
โโโ prisma/
โ   โโโ schema.prisma
โ   โโโ migrations/
โโโ public/
โ   โโโ icons/
โ   โโโ images/
โโโ .env.local
โโโ .env.example
โโโ next.config.ts
โโโ tailwind.config.ts
โโโ tsconfig.json
โโโ package.json
```

## ๐ง Configuraciรณn de Base de Datos

### Schema Principal (Prisma)

```prisma
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  role      Role     @default(USER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  agents    Agent[]
  settings  UserSettings?
}

model Agent {
  id          String   @id @default(cuid())
  name        String
  description String?
  voiceId     String
  prompt      String
  isActive    Boolean  @default(true)
  userId      String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  user        User     @relation(fields: [userId], references: [id])
  calls       Call[]
  usage       Usage[]
}

model Voice {
  id          String  @id @default(cuid())
  retellId    String  @unique
  name        String
  provider    String
  language    String
  gender      String?
  description String?
  isActive    Boolean @default(true)
  
  agents      Agent[]
}

model Call {
  id        String   @id @default(cuid())
  agentId   String
  duration  Int      // en segundos
  cost      Float    // en USD
  status    CallStatus
  createdAt DateTime @default(now())
  
  agent     Agent    @relation(fields: [agentId], references: [id])
}

model Usage {
  id        String   @id @default(cuid())
  agentId   String
  tokens    Int
  minutes   Float
  cost      Float
  date      DateTime @default(now())
  
  agent     Agent    @relation(fields: [agentId], references: [id])
}

enum Role {
  USER
  ADMIN
  SUPER_ADMIN
}

enum CallStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  FAILED
  CANCELLED
}
```

## ๐ Integraciรณn con Retell AI

### Configuraciรณn del SDK

```typescript
// lib/retell.ts
import Retell from 'retell-sdk';

const retellClient = new Retell({
  apiKey: process.env.RETELL_API_KEY!,
});

export { retellClient };
```

### Servicios Principales

```typescript
// lib/services/agent-service.ts
export class AgentService {
  async createAgent(data: CreateAgentData) {
    const retellAgent = await retellClient.agent.create({
      response_engine: {
        type: 'retell-llm',
        llm_id: data.llmId,
      },
      agent_name: data.name,
      voice_id: data.voiceId,
      // ... mรกs configuraciones
    });
    
    return this.saveToDatabase(retellAgent, data);
  }
  
  async updateAgent(id: string, data: UpdateAgentData) {
    // Actualizar en Retell AI
    // Actualizar en base de datos local
  }
  
  async deleteAgent(id: string) {
    // Eliminar de Retell AI
    // Eliminar de base de datos local
  }
}
```

## ๐จ Componentes UI Principales

### Agent Management
- `AgentList`: Lista de agentes con filtros
- `AgentCard`: Tarjeta individual de agente
- `AgentForm`: Formulario de creaciรณn/ediciรณn
- `AgentSettings`: Configuraciรณn avanzada

### Voice Configuration
- `VoiceSelector`: Selector de voces con preview
- `VoicePreview`: Reproductor de audio
- `VoiceSettings`: Configuraciรณn de parรกmetros

### Analytics Dashboard
- `UsageChart`: Grรกfico de uso por tiempo
- `CostChart`: Grรกfico de costos
- `PerformanceMetrics`: Mรฉtricas de rendimiento
- `AgentComparison`: Comparaciรณn entre agentes

## ๐ Sistema de Autenticaciรณn

```typescript
// lib/auth.ts
import NextAuth from 'next-auth';
import CredentialsProvider from 'next-auth/providers/credentials';

export const authOptions = {
  providers: [
    CredentialsProvider({
      name: 'credentials',
      credentials: {
        email: { label: 'Email', type: 'email' },
        password: { label: 'Password', type: 'password' }
      },
      async authorize(credentials) {
        // Validar credenciales
        // Retornar usuario o null
      }
    })
  ],
  callbacks: {
    async jwt({ token, user }) {
      if (user) {
        token.role = user.role;
      }
      return token;
    },
    async session({ session, token }) {
      session.user.role = token.role;
      return session;
    }
  }
};
```

## ๐ Sistema de Monitoreo

### Mรฉtricas en Tiempo Real
- WebSocket para actualizaciones en vivo
- Redis para cache de mรฉtricas
- Alertas automรกticas por email/SMS

### Dashboard de Analytics
- Grรกficos interactivos con Recharts
- Filtros por fecha, agente, tipo de llamada
- Exportaciรณn a PDF/Excel
- Comparativas histรณricas

## ๐ Optimizaciones

### Performance
- Server-side rendering para pรกginas estรกticas
- Client-side rendering para dashboards dinรกmicos
- Lazy loading de componentes pesados
- Memoizaciรณn de cรกlculos complejos

### Caching
- Redis para cache de API responses
- Next.js Image Optimization
- CDN para assets estรกticos
- Service Worker para cache offline

### Escalabilidad
- Database indexing optimizado
- Connection pooling
- Rate limiting en APIs
- Horizontal scaling con load balancer

---

*Esta arquitectura estรก diseรฑada para ser escalable, mantenible y fรกcil de extender con nuevas funcionalidades.*

